# SANS Holiday Hack Challenge 2022 - KringleCon V: Golden Rings
## Recover the Cloud Ring
### Exploit a Smart Contract
Difficulty: :christmas_tree::christmas_tree::christmas_tree::christmas_tree::christmas_tree:  
Exploit flaws in a smart contract to buy yourself a Bored Sporc NFT. Find hints for this objective hidden throughout the tunnels.

#### Solution
I had no clue where to start, so I started by downloading the blockchain’s content thinking that maybe I could copy from someone who already made it. I wrote the following script ([downloader.py](downloader.py)) to download from the blockchain:
```python
import requests
import os

breaker = False
blocknumber = 0
while not breaker:
	response = requests.post("https://prod-blockbrowser.kringle.co.in/cgi-bin/blockdata", json={"blocknumber": blocknumber})
	if "Invalid block number" in response.text:
		breaker = True
	else:
		with open("blocks/{}".format(blocknumber), 'w') as file:
			file.write(response.text)
		print ("Block #{} wrote {} on file".format(blocknumber, len(response.text)))
		blocknumber += 1
```
Knowing I would have to send money to the address `0xe8fC6f6a76BE243122E3d01A1c544F87f1264d3a`, I searched for it and found block #117 where `0xa1861E96DeF10987E1793c8f77E811032069f8E9` made a transaction with comment `Pre-sale purchase of a BSRS NFT.`. Looking for other blocks related to that address I also found block #118 where the following call was made to the function `presale_mint`:
```solidity
function: presale_mint(address,bytes32,bytes32[])
parameters: {'to': '0xa1861E96DeF10987E1793c8f77E811032069f8E9', '_root': b'\xc4t\x1e\x81\x06[\xff\x02v.\xd3\xce\x06ncY\xc1\xf4ae\x18\xe06\x99\xc8\x882\xef\x84\x91p\x14', '_proof': [b'S\x80\xc7\xb7\xae\x81\xa5\x8e\xb9\x8d\x9cx\xdeJ\x1f\xd7\xfd\x955\xfc\x95>\xd2\xbe`-\xaa\xa4\x17g1*']}
```
Back to square one, I had no clue what that meant but I knew I would have found something in the talks and there it is: [You Can Still Have Fun With Non-Fungible Tokens from Prof Qwerty Petabyte!](https://www.youtube.com/watch?v=Qt_RWBq63S8). At the end the Prof says he’s going to make some code available on github. Didn’t take long to find the [QPetabyte/Merkle_Trees](https://github.com/QPetabyte/Merkle_Trees) github repository. Downloaded, just modified the dummy address with mine, maybe added a `print`, and run the code:
```bash
thedead@dellian:~$ python3 merkle_tree.py 
Wallet: 0x4a831cfc7fD1A983b4AF04CfbF5da984bD6f7E7E
Root: 0x38dc3516d6143d1f1c93bb77c231559f4f72fc5e0c887a3db9d9d4ba78bcc235
Proof: ['0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a']
```


---

### Mistakes were made... the key
### The Burning Ring of Fire
## [Narrative](/README.md#narrative)
## [Conclusions](/README.md#conclusions)
### [The Victors shop](/README.md#the-victors-shop)
### [Inbox (1)](/README.md#inbox-1)
---
## [thedead@dellian:~$ whoami](/README.md#thedeaddellian-whoami)
## KringleCon Orientation
## Recover the Tolkien Ring